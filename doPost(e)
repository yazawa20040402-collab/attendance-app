function doPost(e) {
  try {
    // ★JSONでもフォームでも受け取れるようにする
    let body = {};
    const ct = (e && e.postData && e.postData.type) ? String(e.postData.type) : "";
    const raw = (e && e.postData && e.postData.contents) ? String(e.postData.contents) : "";

    if (raw && ct.includes("application/json")) {
      body = JSON.parse(raw);
    } else {
      // application/x-www-form-urlencoded 用
      body = Object.assign({}, e.parameter);
    }

    const action = body.action;
    const traineeId = String(body.traineeId || "").trim();
    const appUrl = String(body.appUrl || "").trim();

    // 以下は今のあなたのロジックのままでOK
    ...
